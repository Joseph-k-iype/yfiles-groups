result = []
for domain in df['domain'].unique():
    domain_dict = {"domain": domain, "sourceSystems": []}
    domain_df = df[df['domain'] == domain]
    
    for sourceSystem in domain_df['sourceSystem'].unique():
        sourceSystem_dict = {"name": sourceSystem, "tables": []}
        sourceSystem_df = domain_df[domain_df['sourceSystem'] == sourceSystem]
        
        for _, row in sourceSystem_df.iterrows():
            table_dict = {"name": row['table'], "connectsTo": []}
            
            # Finding tables this table connects to
            # Excludes tables from the same source system
            connects_to_df = df[(df['domain'] != domain) | (df['sourceSystem'] != sourceSystem)]
            table_dict['connectsTo'] = connects_to_df['table'].tolist()
            
            sourceSystem_dict['tables'].append(table_dict)
        
        domain_dict['sourceSystems'].append(sourceSystem_dict)
    
    result.append(domain_dict)

result
